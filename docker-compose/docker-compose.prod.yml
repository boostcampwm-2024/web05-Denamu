name: denamu-production

include:
  - docker-compose.prod.infra.yml

services:
  # WAS 서비스
  app:
    image: ghcr.io/boostcampwm-2024/web05-Denamu/server:latest
    ports:
      - "8080:8080"
    env_file:
      - /var/prod_config/server/.env.prod
    networks:
      - Denamu
    depends_on:
      mysql-db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - /var/prod_data/server/logs:/app/logs
      - /var/prod_data/server/objects:/app/objects
    environment:
      NODE_ENV: "PROD"
      TZ: "Asia/Seoul"

  # Feed Crawler 서비스
  feed-crawler:
    image: ghcr.io/boostcampwm-2024/web05-Denamu/feed-crawler:latest
    env_file:
      - /var/prod_config/feed-crawler/.env.prod
    networks:
      - Denamu
    depends_on:
      mysql-db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - /var/prod_data/feed-crawler/logs:/app/logs
    environment:
      NODE_ENV: "PROD"
      TZ: "Asia/Seoul"

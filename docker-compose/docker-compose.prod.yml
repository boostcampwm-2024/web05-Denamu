name: denamu-production

include:
  - docker-compose.prod.infra.yml

services:
  # WAS 서비스
  app:
    image: ghcr.io/${GITHUB_REPOSITORY}/server:latest
    ports:
      - "8080:8080"
    env_file:
      - server/env/env.prod
    networks:
      - Denamu
    depends_on:
      mysql-db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ../server/logs:/var/prod_data/server/logs
      - ../server/objects:/var/prod_data/server/objects
    environment:
      NODE_ENV: "PROD"
      TZ: "Asia/Seoul"

  # Feed Crawler 서비스
  feed-crawler:
    image: ghcr.io/${GITHUB_REPOSITORY}/feed-crawler:latest
    env_file:
      - feed-crawler/env/env.prod
    networks:
      - Denamu
    depends_on:
      mysql-db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ../feed-crawler/logs:/var/prod_data/feed-crawler/logs
    environment:
      NODE_ENV: "PROD"
      TZ: "Asia/Seoul"
